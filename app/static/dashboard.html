<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Task Dashboard</title>
  <style>
    body { font-family: Inter, system-ui, Roboto, -apple-system, sans-serif; background:#081229; color:#e6eef8; margin:0; padding:28px; }
    .card { max-width:900px; margin:0 auto; background: linear-gradient(180deg,#071020,#061428); padding:20px; border-radius:12px; box-shadow: 0 10px 40px rgba(2,6,23,0.7); }
    h1 { margin:0 0 8px; font-size:20px }
    .row { display:flex; gap:12px; margin-top:12px; }
    .box { flex:1; padding:14px; background: rgba(255,255,255,0.02); border-radius:8px; text-align:center }
    #chart { height:280px; }
    .pulse { animation: pulse 1.8s infinite; }
    @keyframes pulse { 0% { transform:scale(1); opacity:1 } 50% { transform:scale(1.03); opacity:0.88 } 100% { transform:scale(1); opacity:1 } }
    code { background: rgba(255,255,255,0.03); padding:3px 6px; border-radius:4px; color:#cfe3ff }
  </style>
</head>
<body>
  <div class="card">
    <h1>Task Management — Live Summary</h1>
    <div class="row">
      <div class="box">
        <div id="openCount" style="font-size:28px">—</div>
        <div>Open Tasks</div>
      </div>
      <div class="box pulse">
        <div id="inProgressCount" style="font-size:28px">—</div>
        <div>In Progress</div>
      </div>
      <div class="box">
        <div id="doneCount" style="font-size:28px">—</div>
        <div>Done</div>
      </div>
    </div>

    <canvas id="chart" style="margin-top:18px;"></canvas>
    <div style="margin-top:12px; font-size:13px; color:#9fb0d3">Endpoint: <code>/tasks/</code> — uses demo API data (no auth for demo). </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script>
    async function fetchCounts(){
      try {
        const res = await fetch('/tasks/');
        if(!res.ok) { throw new Error('fetch error ' + res.status); }
        const arr = await res.json();
        let open = 0, ip = 0, done = 0;
        arr.forEach(t => {
          if(t.status === 'open') open++;
          else if(t.status === 'in_progress') ip++;
          else if(t.status === 'done') done++;
        });
        document.getElementById('openCount').innerText = open;
        document.getElementById('inProgressCount').innerText = ip;
        document.getElementById('doneCount').innerText = done;
        return { open, ip, done };
      } catch(e) {
        console.warn('dashboard fetch failed', e);
        return { open:0, ip:0, done:0 };
      }
    }

    const ctx = document.getElementById('chart').getContext('2d');
    const chart = new Chart(ctx, {
      type: 'doughnut',
      data: {
        labels: ['Open','In Progress','Done'],
        datasets: [{ data: [0,0,0], backgroundColor: ['#fb923c', '#60a5fa', '#34d399'] }]
      },
      options: {
        plugins: {
          legend: { labels: { color: '#dbeafe' } }
        }
      }
    });

    async function refresh(){
      const c = await fetchCounts();
      chart.data.datasets[0].data = [c.open, c.ip, c.done];
      chart.update();
    }

    refresh();
    setInterval(refresh, 5000);
  </script>
</body>
</html>
